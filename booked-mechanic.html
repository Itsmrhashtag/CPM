<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Booked Mechanic - CarPartMarketplace</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen">
  <header class="bg-gray-800 text-white py-4">
    <div class="container mx-auto px-4 text-center">
      <h1 class="text-3xl font-semibold">üõ†Ô∏è Booked Mechanic</h1>
    </div>
  </header>

  <main class="container mx-auto px-4 py-8">
    <div id="mechanic-container" class="grid gap-6 grid-cols-1 md:grid-cols-2 lg:grid-cols-3">
      <!-- Booked mechanics will be inserted here -->
    </div>
  </main>

  <script>
    const user = localStorage.getItem("user");
    if (!user) {
      window.location.href = "/login.html";
    }

    const userData = JSON.parse(user);
    const token = userData?.token;

    async function fetchBookedMechanics() {
      try {
        const res = await fetch("http://localhost:8080/api/orders/my-orders", {
          headers: {
            "Authorization": `Bearer ${token}`
          }
        });

        const orders = await res.json();
        const container = document.getElementById("mechanic-container");

        if (!orders.length) {
          container.innerHTML = `<p class="text-center col-span-full text-lg">You haven't booked any mechanics yet.</p>`;
          return;
        }

        orders.forEach(order => {
          if (order.mechanicRequested && order.mechanic) {
            const card = document.createElement("div");
            card.className = "bg-white rounded-lg shadow-md p-6";

            

            card.innerHTML = `
              <h2 class="text-xl font-semibold mb-1">${order.product.title}</h2>
              <p class="text-gray-700 mb-2">${order.product.description}</p>
              <div class="border-t-2 border-gray-300 pt-4 mt-4">
                <h3 class="text-lg font-semibold mb-2">Mechanic Information</h3>
                <p><strong>Name:</strong> ${order.mechanic.name}</p>
                <p><strong>Email:</strong> ${order.mechanic.email}</p>
                <p><strong>Phone:</strong> ${order.mechanic.phone}</p>
                <p><strong>Address:</strong> ${order.mechanic.address}</p>
                <p><strong>Pin Code:</strong> ${order.mechanic.pinCode}</p>
              </div>
              <p class="mt-4"><strong>Status:</strong> 
                <span class="${order.paid ? 'text-green-600' : 'text-red-600'} font-semibold">
                  ${order.paid ? 'Paid' : 'Pending'}
                </span>
              </p>
            `;

            container.appendChild(card);
          }
        });
      } catch (error) {
        console.error("Error loading booked mechanics:", error);
        document.getElementById("mechanic-container").innerHTML = `
          <p class="text-red-500 text-center col-span-full">Failed to load your bookings. Please try again later.</p>
        `;
      }
    }

    fetchBookedMechanics();
  </script>
</body>
</html>
