<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Edit Product</title>
</head>
<body>

  <h2>Edit Product</h2>

  <form id="editForm" enctype="multipart/form-data">
    <input type="hidden" id="productId" value="2"> <!-- Replace with actual product ID or set dynamically -->
    
    <label>Title:</label><br>
    <input type="text" id="title"><br><br>

    <label>Description:</label><br>
    <textarea id="description"></textarea><br><br>

    <label>Price:</label><br>
    <input type="number" id="price" step="0.01"><br><br>

    <label>Category:</label><br>
    <input type="text" id="category"><br><br>

    <label>New Images (optional):</label><br>
    <input type="file" id="images" name="images" multiple><br><br>

    <button type="submit">Update Product</button>
  </form>

  <p id="statusMessage"></p>

  <script>
    const form = document.getElementById('editForm');
    const token = localStorage.getItem('token'); // assuming JWT is stored here

    const productId = document.getElementById('productId').value;

    // Load product data
    window.onload = async () => {
      const res = await fetch(`http://localhost:8080/api/products/${productId}`, {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });
      const data = await res.json();

      document.getElementById('title').value = data.title;
      document.getElementById('description').value = data.description;
      document.getElementById('price').value = data.price;
      document.getElementById('category').value = data.category;
    };

    // Submit update
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const formData = new FormData();
      formData.append('title', document.getElementById('title').value);
      formData.append('description', document.getElementById('description').value);
      formData.append('price', document.getElementById('price').value);
      formData.append('category', document.getElementById('category').value);

      const images = document.getElementById('images').files;
      for (let i = 0; i < images.length; i++) {
        formData.append('images', images[i]);
      }

      try {
        const res = await fetch(`http://localhost:8080/api/products/update/${productId}`, {
          method: 'PUT',
          headers: {
            'Authorization': `Bearer ${token}`
          },
          body: formData
        });

        const text = await res.text();
        document.getElementById('statusMessage').innerText = text;

      } catch (err) {
        console.error('Error updating product:', err);
        document.getElementById('statusMessage').innerText = 'Failed to update product.';
      }
    });
  </script>
</body>
</html>
